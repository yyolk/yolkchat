{"ts":1351445588335,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// Apache 2.0 J Chris Anderson 2011\n$(function() {   \n    // friendly helper http://tinyurl.com/6aow6yn\n    $.fn.serializeObject = function() {\n        var o = {};\n        var a = this.serializeArray();\n        $.each(a, function() {\n            if (o[this.name]) {\n                if (!o[this.name].push) {\n                    o[this.name] = [o[this.name]];\n                }\n                o[this.name].push(this.value || '');\n            } else {\n                o[this.name] = this.value || '';\n            }\n        });\n        return o;\n    };\n\n    var path = unescape(document.location.pathname).split('/'),\n        design = path[3],\n        db = $.couch.db(path[1]);\n    function drawItems() {\n        db.view(design + \"/recent-items\", {\n            descending : \"true\",\n            limit : 50,\n            update_seq : true,\n            success : function(data) {\n                setupChanges(data.update_seq);\n                var them = $.mustache($(\"#recent-messages\").html(), {\n                    items : data.rows.map(function(r) {return r.value;})\n                });\n                $(\"#content\").html(them);\n            }\n        });\n    };\n    drawItems();\n    var changesRunning = false;\n    function setupChanges(since) {\n        if (!changesRunning) {\n            var changeHandler = db.changes(since);\n            changesRunning = true;\n            changeHandler.onChange(drawItems);\n        }\n    }\n    $.couchProfile.templates.profileReady = $(\"#new-message\").html();\n    $(\"#account\").couchLogin({\n        loggedIn : function(r) {\n            $(\"#profile\").couchProfile(r, {\n                profileReady : function(profile) {\n                    $(\"#create-message\").submit(function(e){\n                        e.preventDefault();\n                        var form = this, doc = $(form).serializeObject();\n                        doc.created_at = new Date();\n                        doc.profile = profile;\n                        db.saveDoc(doc, {success : function() {form.reset();}});\n                        return false;\n                    }).find(\"input\").focus();\n                }\n            });\n        },\n        loggedOut : function() {\n            $(\"#profile\").html('<p>Please log in to see your profile.</p>');\n        }\n    });\n });"]],"start1":0,"start2":0,"length1":0,"length2":2273}]],"length":2273}
